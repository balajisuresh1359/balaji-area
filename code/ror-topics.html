<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="description" content="Balaji Suresh ‚Äî personal website for projects, contact, tech notes and portfolio.ROR Topics">
  <meta name="keywords" content="balaji suresh, balaji contacts, balaji suresh website, portfolio, ror notes, ruby on rails - balaji">
  <meta name="author" content="Balaji">
  <meta name="google" content="notranslate">
  <link rel="icon" href="/balaji-area/favicon.png" type="image/png">
  <link rel="canonical" href="https://balajisuresh1359.github.io/balaji-area/code/ror-topics.html">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Balaji | Code</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link href="../styles/index.css" rel="stylesheet">
  <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script defer src="../script/common.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

    <style>
    .audio-player {
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 1.5rem;
      background: white;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      margin: 2rem 0;
    }
    
    .dark .audio-player {
      background: #1f2937;
      border-color: #374151;
    }
    
    .progress-container {
      position: relative;
      height: 6px;
      background: #e5e7eb;
      border-radius: 3px;
      margin: 1rem 0;
      cursor: pointer;
    }
    
    .dark .progress-container {
      background: #4b5563;
    }
    
    .progress-bar {
      height: 100%;
      background: #3b82f6;
      border-radius: 3px;
      width: 0%;
      transition: width 0.1s ease;
    }
    
    .time-display {
      font-family: monospace;
      font-size: 0.875rem;
      color: #6b7280;
    }
    
    .dark .time-display {
      color: #9ca3af;
    }
    
    .control-button {
      background: #f3f4f6;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
      color: #374151;
      font-size: 1rem;
    }
    
    .dark .control-button {
      background: #374151;
      border-color: #4b5563;
      color: #d1d5db;
    }
    
    .control-button:hover {
      background: #e5e7eb;
    }
    
    .dark .control-button:hover {
      background: #4b5563;
    }
    
    .control-button.play-pause {
      width: 48px;
      height: 48px;
      font-size: 1.25rem;
      background: #3b82f6;
      color: white;
      border-color: #3b82f6;
    }
    
    .control-button.play-pause:hover {
      background: #2563eb;
    }
    
    .volume-container {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .volume-slider {
      width: 80px;
      height: 4px;
      background: #e5e7eb;
      border-radius: 2px;
      outline: none;
      cursor: pointer;
    }
    
    .dark .volume-slider {
      background: #4b5563;
    }
    
    .volume-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 14px;
      height: 14px;
      background: #3b82f6;
      border-radius: 50%;
      cursor: pointer;
    }
    
    .speed-selector {
      background: white;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      color: #374151;
      padding: 0.5rem 0.75rem;
      cursor: pointer;
      font-size: 0.875rem;
    }
    
    .dark .speed-selector {
      background: #374151;
      border-color: #4b5563;
      color: #d1d5db;
    }
    
    .speed-selector:focus {
      outline: none;
      border-color: #3b82f6;
    }
    
    .podcast-info {
      margin-bottom: 1.25rem;
    }
    
    .podcast-title {
      font-size: 1.125rem;
      font-weight: 600;
      color: #111827;
      margin-bottom: 0.25rem;
    }
    
    .dark .podcast-title {
      color: #f9fafb;
    }
    
    .podcast-description {
      color: #6b7280;
      font-size: 0.875rem;
    }
    
    .dark .podcast-description {
      color: #9ca3af;
    }

  .outline-item {
    padding: 0.5rem 0.75rem;
    margin: 0.25rem 0;
    border-radius: 0.375rem;
    cursor: pointer;
    transition: all 0.2s;
    display: block;
}

  .outline-item:hover {
    background-color: rgba(48, 47, 49, 0.3);
  }

  .outline-item.active {
    background-color: rgba(48, 47, 49, 0.3);
    border-left: 3px solid #2e2d2f;
  }

  .outline-level-1 {
    font-weight: 600;
    font-size: 0.875rem;
  }

  .outline-level-2 {
    padding-left: 1.5rem;
    font-size: 0.8125rem;
  }

  .outline-level-3 {
    padding-left: 2.5rem;
    font-size: 0.75rem;
    color: #9ca3af;
  }

  .outline-expandable::before {
    content: '‚ñ∂';
    display: inline-block;
    margin-right: 0.5rem;
    transition: transform 0.2s;
    font-size: 0.625rem;
  }

  .outline-expandable.expanded::before {
    transform: rotate(90deg);
  }

  /* Mobile sidebar shown */
  #outlineSidebar.show {
    transform: translateX(0);
  }

  @media (max-width: 768px) {
    #outlineSidebar {
      max-height: 100vh !important;
    }
  }

  </style>
  </head>
<body>
    <nav class="bg-gray-800 text-white p-4">
        <div class="container mx-auto flex justify-between items-center">
        <a href="../index.html" class="font-bold text-xl">Balaji Suresh Babu</a>
        <div class="flex items-center">
            <button id="theme-toggle-mobile" class="md:hidden mr-4 flex items-center justify-center">üåô</button>
            <button id="menu-toggle" class="md:hidden text-2xl focus:outline-none">‚ò∞</button>
        </div>        
        <div id="nav-links" class="hidden md:flex space-x-4 items-center">
        <a href="../blog/index.html" class="px-4">Blog</a>
        <a href="../math/index.html" class="px-4">Math</a>
        <a href="./index.html" class="px-4">Code</a>
        <a href="../contact.html" class="px-4">Contact</a>
      <button id="theme-toggle" class="ml-4">üåô</button>
        </div>
    </div>
    <div id="mobile-menu" class="hidden bg-gray-700 flex flex-col text-center py-2">
      <a href="../blog/index.html" class="px-4">Blog</a>
      <a href="../math/index.html" class="px-4">Math</a>
      <a href="./index.html" class="px-4">Code</a>
      <a href="../contact.html" class="px-4">Contact</a>
  </div>
    </nav>

    <main class="container mx-auto p-4 md:p-6 lg:max-w-4xl code-content">
      <h2 class="text-3xl md:text-4xl font-bold my-6">Ruby on Rails Topics!</h2>
      <hr class="border-gray-300 dark:border-gray-700">
      <p class="text-gray-500 text-sm italic mb-6">Posted on: <span class="font-semibold">April 27, 2025</span></p>

      <div class="pdf-section" style="margin: 2rem 0;">
    <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg overflow-hidden">
    
    <div class="p-4 md:p-6 text-white sticky top-0 z-30" style="background: linear-gradient(135deg, #303032 0%, #414043 100%);">
      <div class="flex items-center justify-between flex-wrap gap-3">
        <div class="flex items-center gap-3">
          <svg class="w-10 h-10 md:w-12 md:h-12" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z" clip-rule="evenodd"/>
          </svg>
          <div>
            <h3 class="text-lg md:text-xl font-bold">ROR Topics</h3>
            <p class="text-white text-opacity-90 text-xs md:text-sm">Ruby on Rails Guide</p>
          </div>
        </div>
        <div class="flex gap-2">
          <button id="toggleOutline" class="bg-white bg-opacity-20 hover:bg-opacity-30 backdrop-blur-sm text-white font-semibold py-2 px-3 md:px-4 rounded-lg transition-colors inline-flex items-center gap-2 text-sm border border-white border-opacity-30">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
            </svg>
            <span class="hidden sm:inline">Outline</span>
          </button>
          <a href="./files/ROR-TOPICS.pdf" 
             target="_blank"
             class="bg-white bg-opacity-20 hover:bg-opacity-30 backdrop-blur-sm text-white font-semibold py-2 px-3 md:px-4 rounded-lg transition-colors inline-flex items-center gap-2 text-sm border border-white border-opacity-30">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
            </svg>
            <span class="hidden sm:inline">View</span>
          </a>
          <a href="./files/ROR-TOPICS.pdf" 
             download="ROR-TOPICS.pdf"
             class="bg-white text-black hover:bg-gray-100 font-semibold py-2 px-3 md:px-4 rounded-lg transition-colors inline-flex items-center gap-2 text-sm">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
            </svg>
            <span class="hidden sm:inline">Save</span>
          </a>
        </div>
      </div>
    </div>

    <!-- PDF Viewer -->
    <div class="bg-gray-50 dark:bg-gray-900">
      
      <!-- Controls -->
      <div id="pdfControls" class="flex items-center justify-between p-3 bg-gray-100 dark:bg-gray-700 border-b border-gray-200 dark:border-gray-600" style="display: none;">
        <div class="flex items-center gap-2">
          <span id="pageInfo" class="text-sm text-gray-700 dark:text-gray-300 px-2 font-medium">Page 1 of 1</span>
        </div>
        <div class="flex items-center gap-2">
        </div>
      </div>

      <!-- Main Content Area with Sidebar -->
      <div class="flex relative">
        
        <!-- Mobile Overlay Background -->
        <div id="sidebarOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 md:hidden" style="display: none;"></div>
        
<!-- Outline Sidebar -->
        <div id="outlineSidebar" class="fixed md:relative top-0 left-0 h-full z-50 bg-gray-700 text-white overflow-y-auto border-r border-gray-700 transition-all duration-300" style="width: 280px; max-height: 100vh;">
          <div class="p-4 relative">
            <div class="flex items-center justify-between mb-4">
              <h3 class="font-semibold text-sm uppercase tracking-wide">Document Outline</h3>
              <button id="closeOutline" class="text-gray-400 hover:text-white text-xl font-bold leading-none p-1">‚úï</button>
            </div>
            <div id="outlineContent" class="text-sm">
            </div>
          </div>
        </div>

        <!-- PDF Content -->
        <div class="flex-1">
          <!-- Loading -->
          <div id="pdfLoading" class="flex items-center justify-center p-12" style="min-height: 400px;">
            <div class="text-center">
              <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"></div>
              <p class="text-gray-600 dark:text-gray-400">Loading PDF...</p>
            </div>
          </div>

          <!-- Canvas Container -->
          <div id="pdfContainer" class="overflow-auto bg-gray-200 dark:bg-gray-900" style="display: none; max-height: 85vh;">
            <div id="pdfPages" class="flex flex-col items-center gap-4 p-4">
              <!-- Pages will be inserted here -->
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
      </div>

    <!-- Podcast Player Section -->
      <div class="audio-player">
        <div class="podcast-info">
          <div class="podcast-title">ROR Deep Dive Notebooklm's Podcast</div>
          <div class="podcast-description">Ruby on Rails Essentials</div>
        </div>
        
        <audio id="podcastAudio" preload="metadata">
          <source src="./files/Ruby on Rails Essentials_ A Quick Reference Guide.mp3" type="audio/mpeg">
          Your browser does not support the audio element.
        </audio>
        
        <div class="flex items-center justify-center gap-3 mb-4">
          <button class="control-button" id="prevBtn" title="Skip back 10s">‚èÆ</button>
          <button class="control-button play-pause" id="playPauseBtn" title="Play/Pause">‚ñ∂</button>
          <button class="control-button" id="nextBtn" title="Skip forward 10s">‚è≠</button>
        </div>
        
        <div class="progress-container" id="progressContainer">
          <div class="progress-bar" id="progressBar"></div>
        </div>
        
        <div class="flex justify-between items-center mb-4">
          <span class="time-display" id="currentTime">00:00</span>
          <span class="time-display" id="totalTime">00:00</span>
        </div>
        
        <div class="flex justify-between items-center">
          <div class="volume-container">
            <span class="text-gray-600 dark:text-gray-400 text-sm">üîä</span>
            <input type="range" id="volumeSlider" class="volume-slider" min="0" max="1" step="0.1" value="1" title="Volume">
          </div>
          
          <select id="speedSelector" class="speed-selector" title="Playback speed">
            <option value="0.5">0.5x</option>
            <option value="0.75">0.75x</option>
            <option value="1" selected>1x</option>
            <option value="1.25">1.25x</option>
            <option value="1.5">1.5x</option>
            <option value="2">2x</option>
          </select>
        </div>
      </div>

      
    
        <script>
          // Podcast Player Functionality
          document.addEventListener('DOMContentLoaded', function() {
            const audio = document.getElementById('podcastAudio');
            const playPauseBtn = document.getElementById('playPauseBtn');
            const progressContainer = document.getElementById('progressContainer');
            const progressBar = document.getElementById('progressBar');
            const currentTimeEl = document.getElementById('currentTime');
            const totalTimeEl = document.getElementById('totalTime');
            const volumeSlider = document.getElementById('volumeSlider');
            const speedSelector = document.getElementById('speedSelector');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            // Format time helper function
            function formatTime(seconds) {
              const minutes = Math.floor(seconds / 60);
              const remainingSeconds = Math.floor(seconds % 60);
              return `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
            }
            
            // Play/Pause functionality
            playPauseBtn.addEventListener('click', function() {
              if (audio.paused) {
                audio.play();
                playPauseBtn.textContent = '‚è∏';
              } else {
                audio.pause();
                playPauseBtn.textContent = '‚ñ∂';
              }
            });
            
            // Update progress bar and time
            audio.addEventListener('timeupdate', function() {
              const progress = (audio.currentTime / audio.duration) * 100;
              progressBar.style.width = progress + '%';
              currentTimeEl.textContent = formatTime(audio.currentTime);
            });
            
            // Set total time when metadata loads
            audio.addEventListener('loadedmetadata', function() {
              totalTimeEl.textContent = formatTime(audio.duration);
            });
            
            // Seek functionality
            progressContainer.addEventListener('click', function(e) {
              const rect = progressContainer.getBoundingClientRect();
              const clickX = e.clientX - rect.left;
              const width = rect.width;
              const clickProgress = clickX / width;
              audio.currentTime = clickProgress * audio.duration;
            });
            
            // Volume control
            volumeSlider.addEventListener('input', function() {
              audio.volume = this.value;
            });
            
            // Speed control
            speedSelector.addEventListener('change', function() {
              audio.playbackRate = parseFloat(this.value);
            });
            
            // Skip backward 10 seconds
            prevBtn.addEventListener('click', function() {
              audio.currentTime = Math.max(0, audio.currentTime - 10);
            });
            
            // Skip forward 10 seconds
            nextBtn.addEventListener('click', function() {
              audio.currentTime = Math.min(audio.duration, audio.currentTime + 10);
            });
            
            // Reset play button when audio ends
            audio.addEventListener('ended', function() {
              playPauseBtn.textContent = '‚ñ∂';
            });
            
            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
              if (e.target.tagName.toLowerCase() !== 'input' && e.target.tagName.toLowerCase() !== 'select') {
                switch(e.code) {
                  case 'Space':
                    e.preventDefault();
                    playPauseBtn.click();
                    break;
                  case 'ArrowLeft':
                    e.preventDefault();
                    prevBtn.click();
                    break;
                  case 'ArrowRight':
                    e.preventDefault();
                    nextBtn.click();
                    break;
                }
              }
            });

            // Original image modal functionality
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            const closeBtn = document.getElementById('closeModal');
            const images = document.querySelectorAll('.image-container img');
            
            let currentScale = 1;
            
            if (images.length > 0) {
              images.forEach(img => {
                img.addEventListener('click', function() {
                  modal.classList.remove('hidden');
                  modalImg.src = this.src;
                  modalImg.alt = this.alt;
                  currentScale = 1;
                  modalImg.style.transform = `scale(${currentScale})`;
                });
              });
            }
            
            if (closeBtn) {
              closeBtn.addEventListener('click', function() {
                modal.classList.add('hidden');
              });
            }
                        
            if (modal) {
              modal.addEventListener('click', function(event) {
                if (event.target === modal) {
                  modal.classList.add('hidden');
                }
              });
            }
            
            document.addEventListener('keydown', function(event) {
              if (event.key === 'Escape' && modal && !modal.classList.contains('hidden')) {
                modal.classList.add('hidden');
              }
            });
          });
        </script>

      <script>
        (function() {
        if (typeof pdfjsLib === 'undefined') {
          console.error('PDF.js not loaded');
          document.getElementById('pdfLoading').innerHTML = `
            <div class="text-center p-6">
              <p class="text-red-600 mb-4 font-semibold">PDF viewer not loaded</p>
              <p class="text-gray-600 text-sm mb-4">Add PDF.js script to &lt;head&gt;</p>
              <a href="./files/ROR-TOPICS.pdf" target="_blank" class="bg-purple-600 text-white px-4 py-2 rounded">Open PDF</a>
            </div>
          `;
          return;
        }

        const pdfUrl = './files/ROR-TOPICS.pdf';
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
        
        let pdfDoc = null;
        let currentScale = 1.0;
        let renderScale = 3.0;
        let isRendering = false;
        let pageElements = {};
        let sidebarVisible = true; 
        const container = document.getElementById('pdfContainer');
        const pagesContainer = document.getElementById('pdfPages');
        const loading = document.getElementById('pdfLoading');
        const controls = document.getElementById('pdfControls');
        const pageInfo = document.getElementById('pageInfo');
        const outlineSidebar = document.getElementById('outlineSidebar');
        const sidebarOverlay = document.getElementById('sidebarOverlay');
        const outlineContent = document.getElementById('outlineContent');
        const toggleOutlineBtn = document.getElementById('toggleOutline');
        const closeOutlineBtn = document.getElementById('closeOutline');
        
        // Initialize sidebar state
        if (window.innerWidth < 768) {
          outlineSidebar.style.transform = 'translateX(-100%)';
          sidebarVisible = false;
        } else {
          outlineSidebar.style.transform = 'translateX(0)';
          sidebarVisible = true;
        }

        // Close sidebar when clicking overlay (mobile)
        sidebarOverlay.addEventListener('click', function() {
          closeSidebar();
        });

        // Close button
        closeOutlineBtn.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          closeSidebar();
        });

        // Toggle button
        toggleOutlineBtn.addEventListener('click', function(e) {
          e.stopPropagation();
          const isDesktop = window.innerWidth >= 768;
          
          if (outlineSidebar.style.transform === 'translateX(-100%)' || !sidebarVisible) {
            openSidebar();
          } else {
            closeSidebar();
          }
        });

        // Open sidebar helper
        function openSidebar() {
          const isDesktop = window.innerWidth >= 768;
          outlineSidebar.style.transform = 'translateX(0)';
          sidebarVisible = true;
          
          if (!isDesktop) {
            sidebarOverlay.style.display = 'block';
            document.body.style.overflow = 'hidden';
          } else {
            // Re-render PDF on desktop to adjust width
            if (pdfDoc && !isRendering) {
              setTimeout(function() {
                renderAllPages();
              }, 100);
            }
          }
        }

        // Close sidebar helper
        function closeSidebar() {
          const isDesktop = window.innerWidth >= 768;
          outlineSidebar.style.transform = 'translateX(-100%)';
          sidebarOverlay.style.display = 'none';
          document.body.style.overflow = '';
          sidebarVisible = false;
          
          // Re-render PDF to fill freed space - force recalculation
          if (isDesktop && pdfDoc && !isRendering) {
            setTimeout(function() {
              renderAllPages();
            }, 100); // Faster for better UX
          }
        }
        
        // Prevent clicks inside sidebar from closing it
        outlineSidebar.addEventListener('click', function(e) {
          e.stopPropagation();
        });
        
        // Scroll to specific page
        function scrollToPage(pageNum) {
          const pageElement = pageElements[pageNum];
          if (pageElement) {
            // Scroll with offset for better visibility
            const containerRect = container.getBoundingClientRect();
            const pageRect = pageElement.getBoundingClientRect();
            const scrollTop = container.scrollTop + pageRect.top - containerRect.top - 20;
            
            container.scrollTo({
              top: scrollTop,
              behavior: 'smooth'
            });
          }
        }
        
        // Render outline
        function renderOutline(outline, containerEl, level = 1) {
          if (!outline || outline.length === 0) {
            containerEl.innerHTML = '<div class="text-gray-400 text-xs">No outline available in this PDF</div>';
            return;
          }
          
          outline.forEach((item) => {
            const div = document.createElement('div');
            div.className = `outline-item outline-level-${Math.min(level, 3)}`;
            
            if (item.items && item.items.length > 0) {
              div.classList.add('outline-expandable');
            }
            
            div.textContent = item.title;
            
            div.addEventListener('click', async function(e) {
              e.stopPropagation();
              
              // Navigate to page
              try {
                let pageNum = null;
                
                if (item.dest) {
                  if (typeof item.dest === 'string') {
                    const dest = await pdfDoc.getDestination(item.dest);
                    if (dest && dest[0]) {
                      const pageIndex = await pdfDoc.getPageIndex(dest[0]);
                      pageNum = pageIndex + 1;
                    }
                  } else if (Array.isArray(item.dest) && item.dest[0]) {
                    const pageIndex = await pdfDoc.getPageIndex(item.dest[0]);
                    pageNum = pageIndex + 1;
                  }
                }
                
                if (pageNum) {
                  scrollToPage(pageNum);
                  
                  // Close sidebar on mobile after navigation
                  if (window.innerWidth < 768) {
                    closeSidebar();
                  }
                }
              } catch (error) {
                console.error('Navigation error:', error);
              }
              
              // Toggle expand/collapse for items with children
              if (item.items && item.items.length > 0) {
                div.classList.toggle('expanded');
                const childContainer = div.nextElementSibling;
                if (childContainer && childContainer.classList.contains('outline-children')) {
                  childContainer.classList.toggle('hidden');
                }
              }
              
              // Highlight active item
              document.querySelectorAll('.outline-item').forEach(el => el.classList.remove('active'));
              div.classList.add('active');
            });
            
            containerEl.appendChild(div);
            
            // Render children
            if (item.items && item.items.length > 0) {
              const childContainer = document.createElement('div');
              childContainer.className = 'outline-children';
              containerEl.appendChild(childContainer);
              renderOutline(item.items, childContainer, level + 1);
            }
          });
        }
        
        // Render a single page
        function renderPage(pageNum) {
          return pdfDoc.getPage(pageNum).then(function(page) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // Calculate available width - check if sidebar is visible
            const sidebarActuallyVisible = outlineSidebar.style.transform === 'translateX(0)' && window.innerWidth >= 768;
            const containerWidth = container.clientWidth - 32;
            
            const viewport = page.getViewport({ scale: 1 });
            const fitScale = containerWidth / viewport.width;
            const displayScale = fitScale * currentScale;
            const actualViewport = page.getViewport({ scale: displayScale * renderScale });
            
            canvas.height = actualViewport.height;
            canvas.width = actualViewport.width;
            canvas.style.width = Math.floor(actualViewport.width / renderScale) + 'px';
            canvas.style.height = Math.floor(actualViewport.height / renderScale) + 'px';
            canvas.className = 'shadow-2xl';
            
            const pageWrapper = document.createElement('div');
            pageWrapper.className = 'relative';
            pageWrapper.setAttribute('data-page', pageNum);
            
            const pageLabel = document.createElement('div');
            pageLabel.className = 'text-center text-sm text-gray-500 dark:text-gray-400 mb-2 font-medium';
            pageLabel.textContent = `Page ${pageNum}`;
            
            pageWrapper.appendChild(pageLabel);
            pageWrapper.appendChild(canvas);
            pagesContainer.appendChild(pageWrapper);
            
            // Store reference for navigation
            pageElements[pageNum] = pageWrapper;
            
            const renderContext = {
              canvasContext: ctx,
              viewport: actualViewport
            };
            
            return page.render(renderContext).promise;
          });
        }
        
        // Render all pages
        async function renderAllPages() {
          if (isRendering) return;
          isRendering = true;
          
          pagesContainer.innerHTML = '';
          pageElements = {};
          
          for (let i = 1; i <= pdfDoc.numPages; i++) {
            await renderPage(i);
          }
          
          isRendering = false;
          updatePageInfo();
        }
        
        // Update page info
        function updatePageInfo() {
          const scrollTop = container.scrollTop;
          const pages = pagesContainer.querySelectorAll('[data-page]');
          
          let currentPage = 1;
          pages.forEach((page, index) => {
            const rect = page.getBoundingClientRect();
            const containerRect = container.getBoundingClientRect();
            
            if (rect.top <= containerRect.top + 100) {
              currentPage = index + 1;
            }
          });
          
          pageInfo.textContent = `Page ${currentPage} of ${pdfDoc.numPages}`;
        }
            
        container.addEventListener('scroll', function() {
          updatePageInfo();
        });
        
        // Load PDF
        pdfjsLib.getDocument(pdfUrl).promise.then(function(pdf) {
          pdfDoc = pdf;
          loading.style.display = 'none';
          container.style.display = 'block';
          controls.style.display = 'flex';
          
          // Load outline
          pdf.getOutline().then(function(outline) {
            renderOutline(outline, outlineContent);
          }).catch(function(error) {
            console.error('Outline error:', error);
            outlineContent.innerHTML = '<div class="text-gray-400 text-xs">No outline available</div>';
          });
          
          renderAllPages();
        }).catch(function(error) {
          console.error('PDF error:', error);
          loading.innerHTML = `
            <div class="text-center p-6">
              <svg class="w-16 h-16 text-red-500 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
              <p class="text-gray-700 dark:text-gray-300 mb-4 font-semibold">Could not load PDF</p>
              <div class="flex gap-2 justify-center flex-wrap">
                <a href="${pdfUrl}" target="_blank" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded font-semibold">Open in New Tab</a>
                <a href="${pdfUrl}" download class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded font-semibold">Download PDF</a>
              </div>
            </div>
          `;
        });
        
        // Handle resize
        let resizeTimeout;
        window.addEventListener('resize', function() {
          clearTimeout(resizeTimeout);
          resizeTimeout = setTimeout(function() {
            if (pdfDoc && !isRendering) {
              renderAllPages();
            }
          }, 300);
        });
      })();
      </script>
      </main>


    <footer class="bg-gray-700 text-white text-center p-4 mt-auto">
        <p>¬© 2025 Content licensed under <a href="LICENSE">MIT License</a>.</p>
    </footer>

</body>
</html>
